"use strict";(self.webpackChunksubstratus_website=self.webpackChunksubstratus_website||[]).push([[2266],{8170:(t,e,o)=>{o.r(e),o.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>k,frontMatter:()=>r,metadata:()=>u,toc:()=>d});var n=o(7462),a=(o(7294),o(3905)),i=o(2004),l=o(2719);const r={slug:"introducing-kubectl-notebook",title:"Introducing: kubectl notebook",authors:[{name:"Nick Stogner",title:"Engineer",url:"https://github.com/nstogner",image_url:"https://avatars.githubusercontent.com/u/10274189?v=4"}],image:"/img/kubectl-notebook-cmd.png",tags:["introduction","feature"]},s=void 0,u={permalink:"/blog/introducing-kubectl-notebook",editUrl:"https://github.com/substratusai/substratusai.github.io/tree/main/blog/2023-08-22-introducing-kubectl-notebook.md",source:"@site/blog/2023-08-22-introducing-kubectl-notebook.md",title:"Introducing: kubectl notebook",description:'"Wouldn\'t it be nice to have a single command that containerized your local directory and served it as a Jupyter Notebook running on a machine with a bunch of GPUs attached?"',date:"2023-08-22T00:00:00.000Z",formattedDate:"August 22, 2023",tags:[{label:"introduction",permalink:"/blog/tags/introduction"},{label:"feature",permalink:"/blog/tags/feature"}],readingTime:2.005,hasTruncateMarker:!1,authors:[{name:"Nick Stogner",title:"Engineer",url:"https://github.com/nstogner",image_url:"https://avatars.githubusercontent.com/u/10274189?v=4",imageURL:"https://avatars.githubusercontent.com/u/10274189?v=4"}],frontMatter:{slug:"introducing-kubectl-notebook",title:"Introducing: kubectl notebook",authors:[{name:"Nick Stogner",title:"Engineer",url:"https://github.com/nstogner",image_url:"https://avatars.githubusercontent.com/u/10274189?v=4",imageURL:"https://avatars.githubusercontent.com/u/10274189?v=4"}],image:"/img/kubectl-notebook-cmd.png",tags:["introduction","feature"]},nextItem:{title:"Tutorial: Llama2 70b serving on GKE",permalink:"/blog/tutorial-llama2-70b-serving-gke"}},c={authorsImageUrls:[void 0]},d=[{value:"Design Goals",id:"design-goals",level:2},{value:"Implementation",id:"implementation",level:2},{value:"More to come!",id:"more-to-come",level:2}],g={toc:d},m="wrapper";function k(t){let{components:e,...r}=t;return(0,a.kt)(m,(0,n.Z)({},g,r,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("img",{src:"/img/kubectl-notebook-cmd.png",alt:"kubectl notebook",width:"100%"}),(0,a.kt)("blockquote",null,'"Wouldn\'t it be nice to have a single command that containerized your local directory and served it as a Jupyter Notebook running on a machine with a bunch of GPUs attached?"'),(0,a.kt)("p",null,"The conversation went something like that while we daydreamed about our preferred workflow. At that point in time we were hopping back-n-forth between Google Colab and our containers while developing a LLM training job."),(0,a.kt)("blockquote",null,'"Annnddd it should automatically sync file-changes back to your local directory so that you can commit your changes to git and kick off a long-running ML training job - containerized with the exact same python version and packages!"'),(0,a.kt)("p",null,"So we built it!"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl notebook -d .\n")),(0,a.kt)("p",null,"And now it has become an integral part of our workflow as we build out the Substratus ML platform."),(0,a.kt)(i.Z,{playing:!0,controls:!0,url:"/video/notebook.mp4",width:"100%",height:"100%",mdxType:"ReactPlayer"}),(0,a.kt)("h2",{id:"design-goals"},"Design Goals"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"One command should do everything."),(0,a.kt)("li",{parentName:"ol"},"Users should only need a Kubeconfig - no other credentials."),(0,a.kt)("li",{parentName:"ol"},"Admins should not need to setup networking, TLS, etc.")),(0,a.kt)("h2",{id:"implementation"},"Implementation"),(0,a.kt)("p",null,"We tackled our design goals using the following techniques:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Implemented as a single Go binary, executed as a ",(0,a.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/"},"kubectl plugin"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://cloud.google.com/storage/docs/access-control/signed-urls"},"Signed URLs")," allow for users to upload their local directory to a bucket without requiring cloud credentials (Similar to how popular consumer clouds function)."),(0,a.kt)("li",{parentName:"ol"},"Kubernetes ",(0,a.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"},"port-forwarding")," allows for serving remote notebooks without requiring admins to deal with networking / TLS concerns. It also leans on existing Kubernetes RBAC for access control.")),(0,a.kt)("p",null,"Some interesting details:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Builds are executed remotely for two reasons:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Users don't need to install docker."),(0,a.kt)("li",{parentName:"ul"},"It avoids pushing massive container images from one's local machine (pip installs often inflate the final docker image to be much larger than the build context itself)."))),(0,a.kt)("li",{parentName:"ul"},"The client requests an upload URL by specifying the MD5 hash it wishes to upload - allowing for server-side signature verification."),(0,a.kt)("li",{parentName:"ul"},"Builds are skipped entirely if the MD5 hash of the build context already exists in the bucket.")),(0,a.kt)("p",null,"The system underneath the ",(0,a.kt)("inlineCode",{parentName:"p"},"notebook")," command:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"diagram",src:o(9734).Z,width:"773",height:"1536"})),(0,a.kt)("h2",{id:"more-to-come"},"More to come!"),(0,a.kt)("p",null,"Lazy-loading large models from disk...\nIncremental dataset loading...\nStay tuned to learn more about how Notebooks on Substratus can speed up your ML workflows."),(0,a.kt)(l.Z,{href:"https://github.com/substratusai/substratus","data-icon":"octicon-star","data-size":"large","data-show-count":"true","aria-label":"Star substratusai/substratus on GitHub",mdxType:"GitHubButton"},"Star"),(0,a.kt)("p",null,"Don't forget to star and follow the repo!"))}k.isMDXComponent=!0},9734:(t,e,o)=>{o.d(e,{Z:()=>n});const n=o.p+"assets/images/kubectl-notebook.excalidraw-6a125456a54abb9b37698ec7483b8687.png"}}]);