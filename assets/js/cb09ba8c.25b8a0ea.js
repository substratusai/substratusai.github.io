"use strict";(self.webpackChunksubstratus_website=self.webpackChunksubstratus_website||[]).push([[4922],{1705:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var o=s(5893),t=s(1151);const a={sidebar_position:1},i="Loading Models",r={id:"guides/loading-models",title:"Loading Models",description:"Import your existing ML models into Substratus.",source:"@site/docs/guides/loading-models.md",sourceDirName:"guides",slug:"/guides/loading-models",permalink:"/docs/guides/loading-models",draft:!1,unlisted:!1,editUrl:"https://github.com/substratusai/substratusai.github.io/tree/main/docs/guides/loading-models.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Guides",permalink:"/docs/category/guides"},next:{title:"Serving Models",permalink:"/docs/guides/serving-models"}},l={},d=[{value:"Loading a Model from HuggingFace",id:"loading-a-model-from-huggingface",level:2},{value:"Loading models from other sources",id:"loading-models-from-other-sources",level:2},{value:"Next steps",id:"next-steps",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"loading-models",children:"Loading Models"}),"\n",(0,o.jsxs)(n.p,{children:["Import your existing ML models into Substratus.\nYou can for example use the Substratus provided ",(0,o.jsx)(n.code,{children:"substratusai/model-loader-huggingface"}),"\ncontainer image to load models into Substratus."]}),"\n",(0,o.jsx)(n.p,{children:"The below Model resource shows an example on how to load the falcon-7b-instruct\nmodel into substratus:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: substratus.ai/v1\nkind: Model\nmetadata:\n  name: falcon-7b-instruct\nspec:\n  image:\n    name: substratusai/model-loader-huggingface\n  params:\n    name: tiiuae/falcon-7b-instruct\n"})}),"\n",(0,o.jsx)(n.p,{children:"In the model spec, you provide the container image location and the name\nof the HuggingFace model. The model-loader-huggingface downloads the model\nand stores it in a predefined location such that the model gets stored\nin a cloud storage bucket (e.g. a GCS bucket)."}),"\n",(0,o.jsxs)(n.p,{children:["The Model ",(0,o.jsx)(n.code,{children:"status.url"})," will provide you with the cloud storage location\nwhere the model is stored."]}),"\n",(0,o.jsx)(n.h2,{id:"loading-a-model-from-huggingface",children:"Loading a Model from HuggingFace"}),"\n",(0,o.jsx)(n.p,{children:"Run the following command to load the falcon-7b-instruct model:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/substratusai/substratus/main/examples/falcon-7b-instruct/base-model.yaml\n"})}),"\n",(0,o.jsx)(n.p,{children:"Once you create the Model, it will create a K8s job to load the HuggingFace model\ninto Substratus. This job will use the container image defined in the Model resource."}),"\n",(0,o.jsx)(n.p,{children:"You can take a look at the logs of the job by running:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl logs jobs/falcon-7b-instruct-modeller | tail -n 10\n"})}),"\n",(0,o.jsx)(n.p,{children:"After about 5 minutes the job should finish and the Model resource should report the status\nto be ready. Verify by running:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl describe model falcon-7b-instruct\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"#  Name:         falcon-7b-instruct\n#  Namespace:    default\n#  Labels:       <none>\n#  Annotations:  <none>\n#  API Version:  substratus.ai/v1\n#  Kind:         Model\n#  Metadata:\n#    Creation Timestamp:  2023-07-15T02:46:05Z\n#    Generation:          1\n#    Resource Version:    14266797\n#    UID:                 077198a0-32ec-4f07-9bc3-ba3a1f1a3729\n#  Spec:\n#    Image:\n#      Name:  substratusai/model-loader-huggingface\n#    Params:\n#      Name:  tiiuae/falcon-7b-instruct\n#  Status:\n#    Conditions:\n#      Last Transition Time:  2023-07-15T02:51:18Z\n#      Message:               \n#      Observed Generation:   1\n#      Reason:                JobComplete\n#      Status:                True\n#      Type:                  Modelled\n#    Ready:                   true\n#    URL:                     gs://my-gcs-bucket-name/077198a0-32ec-4f07-9bc3-ba3a1f1a3729/\n#  Events:                    <none>\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You can see the Model ",(0,o.jsx)(n.code,{children:"status.url"})," field reports the location of where the model is saved."]}),"\n",(0,o.jsx)(n.p,{children:"You have now successfully loaded a HuggingFace model in Substratus and can use that\nmodel in other Substratus resources such as the Server resource."}),"\n",(0,o.jsx)(n.h2,{id:"loading-models-from-other-sources",children:"Loading models from other sources"}),"\n",(0,o.jsxs)(n.p,{children:["If needed you can provide your own container image as long as it meets\nthe container contract defined by Substratus. For\nnow please file an ",(0,o.jsx)(n.a,{href:"https://github.com/substratusai/substratus/issues",children:"Issue on GitHub"})," to request other images."]}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Follow the ",(0,o.jsx)(n.a,{href:"/docs/guides/serving-models",children:"serving models walkthrough"})," to launch a model inference server."]}),"\n",(0,o.jsxs)(n.li,{children:["Follow the ",(0,o.jsx)(n.a,{href:"/docs/guides/loading-datasets",children:"loading datasets walkthrough"})," to prepare a dataset for fine-tuning."]}),"\n",(0,o.jsxs)(n.li,{children:["Follow the ",(0,o.jsx)(n.a,{href:"/docs/guides/finetuning-models",children:"fine-tuning models walkthrough"})," to produce a customized model."]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>r,a:()=>i});var o=s(7294);const t={},a=o.createContext(t);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);