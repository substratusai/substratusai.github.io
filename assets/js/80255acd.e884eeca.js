"use strict";(self.webpackChunksubstratus_website=self.webpackChunksubstratus_website||[]).push([[279],{5765:(t,e,o)=>{o.r(e),o.d(e,{assets:()=>u,contentTitle:()=>r,default:()=>g,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var a=o(7462),n=(o(7294),o(3905)),i=o(2719);const l={slug:"introducing-kubectl-notebook",title:"Introducing: kubectl notebook",authors:[{name:"Nick Stogner",title:"Engineer",url:"https://github.com/nstogner",image_url:"https://avatars.githubusercontent.com/u/10274189?v=4"}],image:"/img/kubectl-notebook-cmd.png",tags:["introduction","feature"]},r=void 0,s={permalink:"/blog/introducing-kubectl-notebook",editUrl:"https://github.com/substratusai/substratusai.github.io/tree/main/blog/2023-08-22-introducing-kubectl-notebook.md",source:"@site/blog/2023-08-22-introducing-kubectl-notebook.md",title:"Introducing: kubectl notebook",description:'"Wouldn\'t it be nice to have a single command that containerized your local directory and served it as a Jupyter Notebook running on a machine with a bunch of GPUs attached?"',date:"2023-08-22T00:00:00.000Z",formattedDate:"August 22, 2023",tags:[{label:"introduction",permalink:"/blog/tags/introduction"},{label:"feature",permalink:"/blog/tags/feature"}],readingTime:2.09,hasTruncateMarker:!1,authors:[{name:"Nick Stogner",title:"Engineer",url:"https://github.com/nstogner",image_url:"https://avatars.githubusercontent.com/u/10274189?v=4",imageURL:"https://avatars.githubusercontent.com/u/10274189?v=4"}],frontMatter:{slug:"introducing-kubectl-notebook",title:"Introducing: kubectl notebook",authors:[{name:"Nick Stogner",title:"Engineer",url:"https://github.com/nstogner",image_url:"https://avatars.githubusercontent.com/u/10274189?v=4",imageURL:"https://avatars.githubusercontent.com/u/10274189?v=4"}],image:"/img/kubectl-notebook-cmd.png",tags:["introduction","feature"]},nextItem:{title:"Tutorial: Llama2 70b serving on GKE",permalink:"/blog/tutorial-llama2-70b-serving-gke"}},u={authorsImageUrls:[void 0]},c=[{value:"Design Goals",id:"design-goals",level:2},{value:"Implementation",id:"implementation",level:2},{value:"More to come!",id:"more-to-come",level:2}],d={toc:c},m="wrapper";function g(t){let{components:e,...l}=t;return(0,n.kt)(m,(0,a.Z)({},d,l,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("img",{src:"/img/kubectl-notebook-cmd.png",alt:"kubectl notebook",width:"100%"}),(0,n.kt)("blockquote",null,'"Wouldn\'t it be nice to have a single command that containerized your local directory and served it as a Jupyter Notebook running on a machine with a bunch of GPUs attached?"'),(0,n.kt)("p",null,"The conversation went something like that while we daydreamed about our preferred workflow. At that point in time we were hopping back-n-forth between Google Colab and our containers while developing a LLM training job."),(0,n.kt)("blockquote",null,'"Annnddd it should automatically sync file-changes back to your local directory so that you can commit your changes to git and kick off a long-running ML training job - containerized with the exact same python version and packages!"'),(0,n.kt)("p",null,"So we built it!"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl notebook -d .\n")),(0,n.kt)("p",null,"And now it has become an integral part of our workflow as we build out the Substratus ML platform."),(0,n.kt)("p",null,"Check out the 50 second screenshare:"),(0,n.kt)("div",{class:"video-container"},(0,n.kt)("iframe",{class:"video",src:"https://www.youtube-nocookie.com/embed/0_PWl6vjqdE",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0})),(0,n.kt)("h2",{id:"design-goals"},"Design Goals"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"One command should build, launch, and sync the Notebook."),(0,n.kt)("li",{parentName:"ol"},"Users should only need a Kubeconfig - no other credentials."),(0,n.kt)("li",{parentName:"ol"},"Admins should not need to setup networking, TLS, etc.")),(0,n.kt)("h2",{id:"implementation"},"Implementation"),(0,n.kt)("p",null,"We tackled our design goals using the following techniques:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Implemented as a single Go binary, executed as a ",(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/"},"kubectl plugin"),"."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://cloud.google.com/storage/docs/access-control/signed-urls"},"Signed URLs")," allow for users to upload their local directory to a bucket without requiring cloud credentials (Similar to how popular consumer clouds function)."),(0,n.kt)("li",{parentName:"ol"},"Kubernetes ",(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"},"port-forwarding")," allows for serving remote notebooks without requiring admins to deal with networking / TLS concerns. It also leans on existing Kubernetes RBAC for access control.")),(0,n.kt)("p",null,"Some interesting details:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Builds are executed remotely for two reasons:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Users don't need to install docker."),(0,n.kt)("li",{parentName:"ul"},"It avoids pushing massive container images from one's local machine (pip installs often inflate the final docker image to be much larger than the build context itself)."))),(0,n.kt)("li",{parentName:"ul"},"The client requests an upload URL by specifying the MD5 hash it wishes to upload - allowing for server-side signature verification."),(0,n.kt)("li",{parentName:"ul"},"Builds are skipped entirely if the MD5 hash of the build context already exists in the bucket.")),(0,n.kt)("p",null,"The system underneath the ",(0,n.kt)("inlineCode",{parentName:"p"},"notebook")," command:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"diagram",src:o(9734).Z,width:"773",height:"1536"})),(0,n.kt)("h2",{id:"more-to-come"},"More to come!"),(0,n.kt)("p",null,"Lazy-loading large models from disk...\nIncremental dataset loading...\nStay tuned to learn more about how Notebooks on Substratus can speed up your ML workflows."),(0,n.kt)(i.Z,{href:"https://github.com/substratusai/substratus","data-icon":"octicon-star","data-size":"large","data-show-count":"true","aria-label":"Star substratusai/substratus on GitHub",mdxType:"GitHubButton"},"Star"),(0,n.kt)("p",null,"Don't forget to star and follow the repo!"))}g.isMDXComponent=!0},9734:(t,e,o)=>{o.d(e,{Z:()=>a});const a=o.p+"assets/images/kubectl-notebook.excalidraw-ca6943c3708f5a4bc157b646827403bd.png"}}]);